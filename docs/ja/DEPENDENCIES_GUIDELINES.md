# サードパーティパッケージ選定基準（アプリケーションレベル）

本ドキュメントは、サプライチェーン攻撃を含む外部依存のリスクを低減するため、
アプリケーションが利用するサードパーティパッケージの選定ガイドラインを定義する。

## 目的

- 信頼性の高いパッケージのみを採用し、保守性と安全性を確保する
- 継続的な脆弱性管理を前提とした安全なエコシステムを維持する
- パッケージ選定の属人化を避け、プロジェクト横断で統一基準を適用する

---

# 1. 信頼性（Popularity & Ecosystem Trust）

## MUST（必須）

- 同用途パッケージの中で一定以上の利用実績がある
  ダウンロード数が上位 3〜5 位程度
- ダウンロード数が十分にある
  10 万 DL 以上
- 直近半年以内にアップデートが行われている
- SemVer に基づいたバージョニングを行っている

## SHOULD（推奨）

- 初回リリースから 1〜2 年以上経過している  
  （ただし大手企業公式 SDK などは例外ルールを認める）
- 依存関係が不必要に多くない
- 破壊的変更が頻繁でない

---

# 2. セキュリティ（Security & Compliance）

## MUST（必須）

- 既知の重大な脆弱性（Critical / High）が未解決で残っていない
  - GitHub Security Advisories
  - NVD（National Vulnerability Database）
  - Packagist Security Advisories など
- メンテナーチームが匿名のみで構成されていない

## SHOULD（推奨）

- SBOM（Software Bill of Materials）の生成が可能である
- セキュリティインシデント対応履歴が迅速である
- Dependabot / Renovate などのセキュリティ更新に対応している
- リリースタグが署名されている（または保護されている）

---

# 3. コード品質（Code Quality）

## MUST（必須）

- テストコードが存在し、CI が稼働している
- 最低限のドキュメント（README、使用例など）が整備されている

## SHOULD（推奨）

- 静的解析ツール（PHPStan / Psalm / ESLint / MyPy 等）に対応している
- コードが読みやすく、極端に複雑な実装でない
- アーキテクチャ思想が明確であり、API が一貫している

---

# 4. プロジェクト継続性（Project Sustainability）

## MUST（必須）

- 直近 6 ヶ月以内にコミットまたは Issue への反応がある
- Issue / PR が放置されていない

## SHOULD（推奨）

- メンテナーが複数人いる（バスファクターが 1 ではない）
- スポンサー、企業、コミュニティなど別の支援母体が存在する

---

# 5. ライセンス（License Compliance）

## MUST（必須）

- ライセンスが業務利用に適していること
  - MIT, Apache-2.0, BSD 系など
- GPL など、アプリケーションとライセンス衝突するものは採用しない

## SHOULD（推奨）

- 依存ライブラリも含めてライセンスの整合性がある  
  （SBOM 等で確認可能であること）

---

# 6. 選定プロセス（Evaluation Process）

1. 上記 MUST をすべて満たすこと
2. SHOULD の 70% 以上を満たすことを望ましい
3. 基準を満たさないが採用したい場合、**例外申請** を行うこと
4. 例外はチーム内レビューまたはアーキテクト承認を必要とする

---

# 7. 継続的チェック（Ongoing Review）

- 定期的に既存パッケージの棚卸しを行う
  - 脆弱性チェック
  - メンテ状況の確認
  - 非推奨パッケージの置き換え検討
- Dependabot / Renovate による更新を常時有効にする

---

# 8. 例外ルール（Exception Rules）

以下の場合、通常の MUST/SHOULD 基準を満たさないパッケージでも採用を認めることがある。

## 8.1 公式 SDK / 公式クライアント

- AWS, GCP, Stripe, PayPal, Slack などの **公式が提供・保守しているパッケージ**
- 初回リリースからの期間が短い、DL 数が少ないなどは基準対象外
- ただしセキュリティアドバイザリ対応が遅い場合は代替案を検討する

## 8.2 業務要件に固有のドメインライブラリ

- 特定の業務要件を満たすために代替が存在しない場合
- 内部に閉じた利用であり、影響範囲が限定的な場合
- そのパッケージの安全性評価（コードレビューなど）を追加で行うこと

## 8.3 新興だが有望なライブラリ

- コミュニティの成長速度が速く、今後の標準になり得るもの
- メンテナーの信頼性・活動実績が高い場合（例：著名 OSS 開発者）
- 導入時に「試験導入」とし、運用プロジェクトで実際の動向を半年観測する

## 8.4 社内フォーク・内部改修を前提とする場合

- OSS 版に課題があるが、**社内でフォークし保守できる体制がある**
- ライセンスがフォークを許可していることが必須
- フォーク後は依存が外部サプライチェーンから切り離されるため、基準緩和を認める

## 8.5 インフラ構成やセキュリティ製品が強制するパッケージ

- APM（New Relic 等）、セキュリティエージェント、Observability エージェント
- プラットフォームとの互換性のため採用が必須のケース
- ベンダー側のサポートポリシーに準拠する

---

<!-- # 付録：評価シート（テンプレート）

| 項目                       | MUST | SHOULD | 評価 |
| -------------------------- | ---- | ------ | ---- |
| ダウンロード数・普及度     | ✔    |        |      |
| メンテ状況（半年以内更新） | ✔    |        |      |
| 重大脆弱性の有無           | ✔    |        |      |
| テストコードと CI          | ✔    |        |      |
| ライセンス適合性           | ✔    |        |      |
| コミュニティ活発度         |      | ✔      |      |
| メンテナー複数人           |      | ✔      |      |
| ドキュメント整備           |      | ✔      |      |

※ MUST をすべて満たし、SHOULD の一定割合を満たす場合に採用可。
※ 例外採用時は「例外理由」と「承認者」を記録すること。

--- -->
