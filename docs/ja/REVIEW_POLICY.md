# レビューポリシー

## 🎯 レビューの責務

1. **目的と要件の整合**  
   - PRの背景・目的（チケット/AC）を理解し、受け入れ基準を満たしているか確認する。  

2. **テストと証跡の確認**  
   - 単体/統合/E2Eのテスト有無・妥当性を確認する。  
   - CIが緑かを確認する。  
   - スクショ/動画/再現手順など、テスト証跡が提示されているかを確認する。  

3. **設計・保守性**  
   - 責務分割、命名、一貫性、複雑度、テクニカルデットの有無をチェックする。  

4. **セキュリティ/権限/品質リスク**  
   - 入力検証、認可、秘密情報、外部I/F変更、パフォーマンス影響などを確認する。  

5. **リファクタ余地（任意）**  
   - 重複・冗長・構造改善などの改善点を確認する。ただし要件充足確認を優先する。  
   - 改善提案は **品質向上** だけでなく **リリーススケジュールへの影響** も考慮する。  

---

## 📐 運用原則

1. **単一目的（Single Responsibility）**  
   - バグ修正とリファクタは原則分割する。  
   - 例外として、振る舞い不変の最小リファクタのみ同一PRに含めてよい（別コミットで小さく）。  

2. **AC・テスト証跡の必須化**  
   - 受け入れ基準（AC）、テスト結果（CIリンク/スクショ/動画）、再現手順を必須とする。  
   - 埋まっていないPRは受け付けられない。  

3. **レビューのレベル分け**  
   - **L0：微修正** → 要件確認は軽め、CI/テスト中心。  
   - **L1：機能追加/修正** → ACと証跡の確認必須。  
   - **L2：高リスク**（スキーマ/セキュリティ/課金処理/外部連携など） → ペアレビュー＋実機確認。  

👉 詳細な基準や具体例は [レベル判定ガイド](#-レベル判定ガイド) を参照。  

4. **テスト先行・品質底上げ**  
   - バグ修正は「再現テスト → 修正 → 回帰確認」の順序で。  
   - テストカバレッジが十分でない場合は、人によるAC/証跡確認で補完する。  
   - 中長期的には、優先領域からテストカバレッジの継続的な向上を目指す。  

5. **コミット運用**  
   - `test:`（再現/回帰）、`fix:`（修正）、`refactor:`（振る舞い不変）を分ける。  
   - 自動整形や大量リネームは専用PRまたは先行PRで扱う。  

6. **RACI（責任分担）の整理**  
   - 実装者 → 要件充足とテスト作成 **(R)**  
   - レビュアー/テックリード → 品質ゲート責任、設計・リスク確認 **(A/C)**  
   - QA/PM → 受け入れ基準定義、最終適合判断 **(A/C)**  

👉 詳細な役割分担は [RACIマトリクス](#-raciマトリクス) を参照。  

7. **影響範囲の明示**  
   - API/DB/認可/UI/外部システムへの影響をPR内で明示し、見落としを防止する。  

8. **PR単位の原則**  
   - 1回あたりのレビュー量はできる限り小さくする（目安：レビュワーが15分以内に読める量）。  
   - 理想的なPRのサイズは200〜400行程度。  
   - 小さなPRは不具合発見率が高いとされる。  
   - 小さな単位でマージ可能にするためには、事前の設計が重要。  

---

## ✅ 簡易チェックリスト

- [ ] PRにACとテスト証跡が揃っている  
- [ ] CIが緑である  
- [ ] 要件が満たされている  
- [ ] セキュリティ/権限/品質リスクを確認した  
- [ ] 影響範囲が明示されている  
- [ ] リファクタは別PRか、最小限にコミット分離されている  

---

## 💡 レビューの心得

### 1. Humility, Respect, and Trust （謙虚・尊敬・信頼）
- 謙虚な姿勢でレビューを受け入れる  
- 他者を尊重し、信頼を前提にフィードバックを行う  
- 批判ではなく「チームの資産を良くする」視点で臨む  

### 2. レビューの目的を明確にする
- コードレビューは **価値提供・品質向上・チーム成長** のための手段  
- スキルを競う場やマウントを取る場ではない  
- レビュー依頼時に観点を共有する  
  - 良い例：「ロジック整合性のみ見てください。命名は後で直します」  

### 3. 建設的なコミュニケーション
- 意図が分からないコードは **質問する**（決めつけない）  
- **良いところもコメントする**（褒めポイントを明示）  
- 指摘は必ず **理由を論理的に説明する**  
- AIがレビューコメントを行う場合、**レビュイーの言語設定**に合わせてコメントする  

### 4. レビューの姿勢
- レビュイーは指摘を **謙虚に受け止める**  
- レビュワーは **承認したコードに責任を持つ**  
- コメントは **人格否定ではなく品質改善のため** であることを忘れない  

### 5. 効率的な議論
- 設計レベルなど大きな議論は **対面または口頭で話す**  
- **同じゴールに複数のアプローチがある**ことを受け入れる  

---

## 📊 レベル判定ガイド

### ✅ 判定クイックチェック
- **振る舞い変更が一切ない** → L0 候補  
- **ユーザー／外部システムに見える振る舞いが変わる** → L1 以上  
- **公開I/F（API/イベント/CLI/設定の意味）が変わる** → L1 以上  
- 迷ったら **上のレベルに寄せる（L1 を選ぶ）**  

### 🧭 具体例（L0）
- コメント/README の修正  
- 未使用 import 削除、フォーマッタ適用  
- ログ追加（性能・PII影響なし）  
- 型注釈や軽微な lint 修正  

### 🧭 具体例（L1）
- バグ修正や新機能追加  
- API 入出力やバリデーションの変更  
- 権限チェックやビジネスルールの修正  
- パフォーマンスに影響するクエリ変更  

### ⚠️ グレーゾーン対応
- **CSS/スタイル**：ユーザー可視 → L1  
- **ログ**：追加は L0、レベル変更やPII追加は L1  
- **設定ファイル**：意味変更は L1、整形のみは L0  

### 🏷️ 運用ルール
- 迷ったら **L1 に格上げ**  
- PR タイトルに `[L0]` / `[L1]` / `[L2]` を付与  
- L0 で提出後に挙動変更が見つかった場合は L1 に再分類  

---

## 📊 RACIマトリクス

| 役割            | 実行責任 (R)             | 最終責任 (A)          | 相談先 (C)                              | 報告先 (I) |
|-----------------|--------------------------|-----------------------|-----------------------------------------|------------|
| **実装者**      | 要件を満たす実装・テスト | ―                     | テックリード、レビュアー                | QA/PM      |
| **レビュアー**  | コードレビューと改善提案 | ―                     | テックリード（難易度の高い場合）        | QA/PM      |
| **テックリード**| ―                        | 品質ゲートの最終責任  | PM、QA（必要に応じて）                  | 経営層/PM  |
| **QA / PM**     | テスト仕様・AC定義       | 受け入れ基準適合の最終責任 | テックリード、レビュアー、実装者       | 経営層     |
